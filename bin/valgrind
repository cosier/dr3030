#!/bin/bash

DIR="$( cd  "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
ROOT=$( cd $DIR/../ && pwd )

mkdir -p $ROOT/build && cd $ROOT/build;

DEBUG=true $ROOT/bin/build

if [ ! $? -eq 0 ]; then
  echo "Cannot run Valgrind, build broken."
  exit 1
fi

if [[ $FULL == true ]]; then
  valgrind -v --show-reachable=yes --leak-check=full $ROOT/bin/dr3030 $@
else
  valgrind -v --quiet --leak-check=full $ROOT/bin/dr3030 $@
fi
